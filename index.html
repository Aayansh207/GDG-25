<!DOCTYPE html>
<html class="dark" lang="en">

<head>
  <!-- Basic document metadata -->
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>Neuro Ranger - GDG MNNIT</title>

  <!-- Tailwind CSS + plugins -->
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>

  <!-- Google Fonts: Roboto -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet" />

  <!-- Material Symbols -->
  <link
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    rel="stylesheet" />

  <!-- Custom Tailwind configuration -->
  <script id="tailwind-config">
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: "#f9ab00",
            accent: "#4285f4",
            surface: "#0A0A0A",
            nav_bg: "#111111"
          },
          fontFamily: { display: ["Roboto", "sans-serif"] },
          borderRadius: { DEFAULT: "8px" },
          animation: {
            "spin-slow": "spin 2.5s linear infinite",
            "float": "float 6s ease-in-out infinite"
          },
          boxShadow: {
            "glow-accent": "0 0 20px 0 rgba(66,133,244,0.5)",
            "glow-primary": "0 0 20px 0 rgba(249,171,0,0.5)"
          },
          keyframes: {
            float: {
              '0%, 100%': { transform: 'translateY(0px)' },
              '50%': { transform: 'translateY(-12px)' }
            }
          },
          textShadow: {
            glow: "0 0 30px rgba(249, 171, 0, 0.6)",
            "glow-strong": "0 0 40px rgba(249, 171, 0, 0.8)",
            "glow-soft": "0 0 20px rgba(249, 171, 0, 0.4)"
          }
        }
      },
      plugins: [
        function ({ addUtilities }) {
          addUtilities({
            '.text-glow': { textShadow: '0 0 30px rgba(249, 171, 0, 0.6)' },
            '.text-glow-strong': { textShadow: '0 0 40px rgba(249, 171, 0, 0.8)' },
            '.text-glow-soft': { textShadow: '0 0 20px rgba(249, 171, 0, 0.4)' }
          })
        }
      ]
    };
  </script>

  <!-- Video Background Styles -->
  <style>
    body {
      min-height: 100dvh;
      margin: 0;
      background-color: #000000;
    }

    #video-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -2;
      overflow: hidden;
    }

    #video-bg video {
      position: absolute;
      top: 50%;
      left: 50%;
      min-width: 100%;
      min-height: 100%;
      width: auto;
      height: auto;
      transform: translate(-50%, -50%);
      object-fit: cover;
    }

    #video-bg::after {
      content: "";
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.65);
      z-index: -1;
    }

    .backdrop-blur-custom {
      backdrop-filter: blur(8px);
    }

    .scroll-container {
      overflow: y-auto;
      overflow: x-hidden;
    }
  </style>
</head>

<body class="font-display flex flex-col min-h-screen text-white">

  <!-- FULL-SCREEN VIDEO BACKGROUND -->
  <div id="video-bg">
    <video autoplay muted loop playsinline preload="auto">
      <source src="./N.mp4" type="video/mp4">
      Your browser does not support the video tag.
    </video>
  </div>

  <!-- FIXED SIDEBAR -->
  <aside
    class="fixed inset-y-0 left-0 w-20 flex flex-col items-center bg-nav_bg/80 backdrop-blur-custom border-r border-white/10 z-20">
    <div class="text-primary flex items-center justify-center py-6">
      <img src="./logo.jpg" alt="GDG MNNIT" class="h-10 w-auto" />
    </div>

    <nav class="flex flex-col items-center gap-8 mt-6 flex-1">
      <!-- Upload - Active on index -->
      <a class="text-accent hover:text-accent transition-colors" href="index.html" title="Upload">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10" fill="none" viewBox="0 0 24 24" stroke="currentColor"
          stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
        </svg>
      </a>

      <a class="text-white/60 hover:text-accent transition-colors" href="summary.html" title="Summary">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10" fill="none" viewBox="0 0 24 24" stroke="currentColor"
          stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
      </a>

      <a class="text-white/60 hover:text-accent transition-colors" href="history.html" title="History">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10" fill="none" viewBox="0 0 24 24" stroke="currentColor"
          stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 12l-3-3" />
        </svg>
      </a>

      <a class="text-white/60 hover:text-accent transition-colors" href="full-search.html" title="Full Search">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10" fill="none" viewBox="0 0 24 24" stroke="currentColor"
          stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
      </a>
    </nav>
  </aside>

  <!-- MAIN CONTENT -->
  <main class="ml-20 flex-1 p-6 flex flex-col gap-8 scroll-container min-h-screen">

    <!-- Stats - fully left aligned near navbar -->
    <div class="pt-6 px-6">
      <div class="flex flex-col md:flex-row gap-x-16 gap-y-8">
        <div class="text-left">
          <p id="total-docs" class="text-3xl font-bold text-primary tracking-tight text-glow">
            ...
          </p>
          <p class="text-white/60 text-base md:text-lg mt-2">
            Total Documents Uploaded
          </p>
        </div>

        <div class="text-left">
          <p id="time-saved" class="text-3xl font-bold text-primary tracking-tight text-glow">
            ... hrs
          </p>
          <p class="text-white/60 text-base md:text-lg mt-2">
            Total Time Saved
          </p>
        </div>
      </div>
    </div>


    <!-- Drag & Drop Upload Zone -->
    <div id="drop-zone"
      class="flex flex-col items-center justify-between gap-4 border-2 border-dashed border-accent w-full max-w-[700px] mx-auto h-[50vh] bg-black/40 backdrop-blur-custom px-10 py-8 cursor-pointer shadow-glow-accent rounded-xl transition">

      <div class="flex flex-col items-center gap-4 mt-[-5vh]">
        <div class="text-accent">
          <span class="material-symbols-outlined !text-8xl">cloud_upload</span>
        </div>
        <div class="flex flex-col items-center gap-2">
          <p class="text-white text-3xl font-bold text-center">Drag & Drop Files Here</p>
          <p class="text-white/70 text-base text-center">PDF, JPEG, PNG, JPG, TXT supported</p>
        </div>
      </div>

      <div id="upload-block" class="flex flex-col items-center gap-6">
        <button id="select-btn"
          class="flex items-center justify-center rounded-xl h-16 px-12 bg-accent text-black font-bold text-lg hover:brightness-110 transition shadow-lg">
          Select File
        </button>
      </div>

      <input id="file-input" type="file" class="hidden"
        accept="application/pdf,image/jpeg,image/png,image/jpg,text/plain" />

      <div id="loader" class="hidden flex flex-col items-center gap-2">
        <div class="w-12 h-12 border-4 border-accent border-t-transparent rounded-full animate-spin"></div>
        <p class="text-white/70 text-base">Processing your document...</p>
      </div>

      <button id="summarize-btn"
        class="hidden flex items-center justify-center rounded-xl h-16 px-12 bg-primary text-black font-bold text-lg hover:brightness-110 transition shadow-lg">
        Summarize Now
      </button>
    </div>

    <!-- Semantic Search -->
    <div class="max-w-[700px] mx-auto w-full mt-4">
      <form id="search-form" class="flex gap-0">
        <input id="search-input" type="text" placeholder="Ask anything about your documents..."
          class="flex-1 bg-surface/80 backdrop-blur-custom border border-r-0 border-accent/50 rounded-l-xl px-6 py-4 text-white placeholder-white/50 focus:outline-none focus:border-accent" />
        <button type="submit"
          class="bg-accent text-black font-bold px-6 py-3 rounded-r-xl hover:brightness-110 transition flex items-center justify-center">
          <span class="material-symbols-outlined text-2xl font-bold">search</span>
        </button>
      </form>
    </div>

  </main>

  <!-- JavaScript -->
  <script>
    const selectBtn = document.getElementById("select-btn");
    const fileInput = document.getElementById("file-input");
    const uploadBlock = document.getElementById("upload-block");
    const loader = document.getElementById("loader");
    const summarizeBtn = document.getElementById("summarize-btn");
    const dropZone = document.getElementById("drop-zone");

    async function handleFile(file) {
      if (!file) return;

      uploadBlock.classList.add("hidden");
      loader.classList.remove("hidden");
      summarizeBtn.classList.add("hidden");

      const formData = new FormData();
      formData.append("file", file);

      try {
        const response = await fetch("http://127.0.0.1:8000/preprocess", {
          method: "POST",
          body: formData
        });

        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(errorText || `Server error: ${response.status}`);
        }

        const result = await response.json();

        localStorage.setItem("currentDocId", result.doc_id);
        localStorage.setItem("uploadedFileName", file.name);
        localStorage.setItem("uploadedFileDate", new Date().toLocaleString());

        loader.classList.add("hidden");
        summarizeBtn.classList.remove("hidden");

      } catch (err) {
        console.error("Upload failed:", err);
        loader.classList.add("hidden");
        uploadBlock.classList.remove("hidden");
        alert("Upload failed: " + err.message);
      }
    }

    selectBtn.addEventListener("click", () => fileInput.click());
    fileInput.addEventListener("change", e => handleFile(e.target.files[0]));

    dropZone.addEventListener("dragover", e => {
      e.preventDefault();
      dropZone.classList.add("border-white");
    });
    dropZone.addEventListener("dragleave", () => dropZone.classList.remove("border-white"));
    dropZone.addEventListener("drop", e => {
      e.preventDefault();
      dropZone.classList.remove("border-white");
      handleFile(e.dataTransfer.files[0]);
    });

    summarizeBtn.addEventListener("click", () => {
      const docId = localStorage.getItem("currentDocId");
      window.location.href = `summary.html?id=${docId}`;
    });

    async function loadStats() {
      try {
        const res = await fetch("http://127.0.0.1:8000/analysis");
        if (!res.ok) throw new Error();
        const data = await res.json();
        document.getElementById("total-docs").textContent = data.total_documents || "0";
        document.getElementById("time-saved").textContent = (data.time_saved || "0") + " hrs";
      } catch {
        document.getElementById("total-docs").textContent = "0";
        document.getElementById("time-saved").textContent = "0 hrs";
      }
    }
    loadStats();

    document.getElementById("search-form").addEventListener("submit", e => {
      e.preventDefault();
      const query = document.getElementById("search-input").value.trim();
      if (query) {
        window.open(`full-search.html?query=${encodeURIComponent(query)}`, "_blank");
      }
    });
  </script>
</body>

</html>
